<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cat√°logo de Repuestos y Servicios | Taller</title>
  <meta name="description" content="Explora repuestos y servicios disponibles: stock actualizado, retiro en taller o env√≠o en Bogot√°." />
  <meta name="keywords" content="repuestos automotriz, taller, cat√°logo, env√≠o bogot√°, instalaci√≥n" />
  <meta property="og:title" content="Cat√°logo de Repuestos y Servicios" />
  <meta property="og:description" content="Consulta disponibilidad y solicita tus repuestos con pago contra entrega." />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="es_CO" />
  <link rel="canonical" href="/catalogo.html" />
  <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: ['class', '.theme-light'],
      theme: {
        extend: {
          colors: {
            'dark-bg': '#0f172a',
            'dark-card': '#111827',
            'dark-card-alt': '#0b1220',
            'dark-text': '#e5e7eb',
            'dark-muted': '#9ca3af',
            'dark-border': '#1f2937',
          }
        }
      }
    }
  </script>
  <style>
    /* Estilos para modo claro - Sobrescribir colores de Tailwind */
    body.theme-light [class*="from-slate-900"][class*="via-slate-800"][class*="to-slate-900"],
    body.theme-light [class*="bg-gradient-to-r"][class*="from-slate-900"] {
      background: linear-gradient(to right, #f8fafc, #f1f5f9, #f8fafc) !important;
    }
    body.theme-light [class*="bg-slate-800/50"],
    body.theme-light [class*="bg-slate-800"][class*="/50"] {
      background-color: rgba(241, 245, 249, 0.8) !important;
    }
    body.theme-light [class*="bg-slate-800"]:not([class*="/"]):not([class*="hover"]):not([class*="from"]):not([class*="via"]):not([class*="to"]) {
      background-color: #f1f5f9 !important;
    }
    body.theme-light .text-white:not(.bg-blue-600):not(.bg-blue-700):not(.bg-purple-600):not(.bg-purple-700) {
      color: #0f172a !important;
    }
    body.theme-light .text-slate-300 {
      color: #475569 !important;
    }
    body.theme-light .text-slate-400 {
      color: #64748b !important;
    }
    body.theme-light [class*="border-slate-700/50"],
    body.theme-light [class*="border-slate-700"][class*="/50"] {
      border-color: rgba(203, 213, 225, 0.5) !important;
    }
    body.theme-light [class*="hover:bg-slate-700/50"]:hover,
    body.theme-light button:hover[class*="hover:bg-slate-700"] {
      background-color: rgba(203, 213, 225, 0.5) !important;
    }
    body.theme-light [class*="hover:text-white"]:hover:not(.bg-blue-600):not(.bg-blue-700) {
      color: #0f172a !important;
    }
    /* Estilos para el fondo de la p√°gina */
    body {
      background-color: #0f172a;
      min-height: 100vh;
    }
    body.theme-light {
      background-color: #f8fafc;
    }
    /* Estilos del cat√°logo p√∫blico */
    body.catalog-public { --pg-max-width: 1200px; }
    .hero-slider { position:relative; }
    .hero-slides { display:grid; }
    .hero-slide { opacity:0; transform:translateY(6px); transition:opacity .6s ease, transform .6s ease; position:relative; display:flex; flex-direction:column; gap:6px; padding:8px 4px; }
    .hero-slide.active { opacity:1; transform:translateY(0); }
    .hero-slide h2 { margin:0; font-size: clamp(1.05rem,2.6vw,1.6rem); }
    .hero-slide p { margin:0; font-size:14px; line-height:1.3; max-width:560px; }
    .hero-nav { display:flex; gap:8px; margin-top:14px; }
    .hero-dot { width:14px; height:14px; border-radius:50%; border:2px solid rgba(255,255,255,.7); background:transparent; cursor:pointer; padding:0; transition:background .3s,border-color .3s; }
    .hero-dot.active { background:#fff; border-color:#fff; }
    .hero-arrows { position:absolute; top:8px; right:8px; display:flex; gap:6px; }
    .hero-prev,.hero-next { background:rgba(255,255,255,.15); backdrop-filter:blur(4px); border:1px solid rgba(255,255,255,.25); color:#fff; padding:6px 10px; border-radius:8px; cursor:pointer; font-size:12px; }
    .hero-prev:hover,.hero-next:hover { background:rgba(255,255,255,.3); }
    .slider-cta { align-self:flex-start; margin-top:4px; background:#fff; color:#0f172a; font-weight:600; padding:8px 14px; border-radius:8px; border:0; cursor:pointer; font-size:13px; }
    .slider-cta:hover { background:#e2e8f0; }
    .visually-hidden { position:absolute !important; width:1px !important; height:1px !important; padding:0 !important; margin:-1px !important; overflow:hidden !important; clip:rect(0 0 0 0) !important; white-space:nowrap !important; border:0 !important; }
    .badge { position:absolute; left:8px; top:8px; background:rgba(2,132,199,.9); color:#fff; font-size:11px; padding:3px 8px; border-radius:999px; box-shadow:0 2px 8px rgba(2,132,199,.4); }
    .badge.low { background:#ef4444; }
    .search-hit { animation:blink .9s ease; }
    @keyframes blink { 0% { background:rgba(255,255,0,.35); } 100% { background:transparent; } }
    .skeleton { background: linear-gradient(90deg, rgba(148,163,184,.15), rgba(148,163,184,.25), rgba(148,163,184,.15)); background-size:200% 100%; animation: shimmer 1.2s infinite; }
    @keyframes shimmer { 0%{ background-position:200% 0; } 100%{ background-position: -200% 0; } }
    /* Estilos personalizados para barras de scroll */
    .custom-scrollbar {
      scrollbar-width: thin;
      scrollbar-color: rgba(148, 163, 184, 0.5) transparent;
    }
    .custom-scrollbar::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
      background: transparent;
      border-radius: 4px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.5);
      border-radius: 4px;
      transition: background 0.2s ease;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: rgba(148, 163, 184, 0.7);
    }
    body.theme-light .custom-scrollbar {
      scrollbar-color: rgba(100, 116, 139, 0.4) transparent;
    }
    body.theme-light .custom-scrollbar::-webkit-scrollbar-thumb {
      background: rgba(100, 116, 139, 0.4);
    }
    body.theme-light .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: rgba(100, 116, 139, 0.6);
    }
  </style>
  <!-- Backend config must load before API to set API_BASE/BACKEND_URL -->
  <script src="./assets/js/config.js"></script>
  <script src="./assets/js/api.js"></script>
  <script type="module" src="./assets/js/api.esm.js"></script>
  <!-- Migrado a versi√≥n segmentada por empresa -->
  <script type="module" src="./assets/js/catalog-public.js"></script>
  <script type="module" src="./assets/js/promo-slider.js"></script>
  <script>
    // Lazy image upgrade (IntersectionObserver) para browsers sin soporte nativo avanzado
    document.addEventListener('DOMContentLoaded', () => {
      const supportsNative = 'loading' in HTMLImageElement.prototype;
      const imgs = document.querySelectorAll('img');
      if(supportsNative){
        imgs.forEach(im => im.setAttribute('loading','lazy'));
        return;
      }
      const obs = new IntersectionObserver(entries => {
        entries.forEach(e => {
          if(e.isIntersecting){
            const im = e.target;
            const src = im.dataset.src;
            if(src){ im.src = src; }
            obs.unobserve(im);
          }
        });
      }, { rootMargin: '200px' });
      imgs.forEach(im => {
        if(!im.dataset.src){ im.dataset.src = im.src; im.src = 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22150%22></svg>'; }
        obs.observe(im);
      });
    });
  </script>
</head>
<body class="catalog-public" data-page="catalog-public">
  <header class="bg-slate-800 dark:bg-slate-800 theme-light:bg-white border-b border-slate-700/50 dark:border-slate-700/50 theme-light:border-slate-300 shadow-md sticky top-0 z-50 px-4 py-3">
    <div class="flex items-center gap-4 flex-wrap">
      <strong class="text-base font-semibold text-white dark:text-white theme-light:text-slate-900">Cat√°logo</strong>
      <nav class="flex items-center gap-2">
        <a href="catalogo.html" class="px-3 py-1.5 rounded-lg text-sm font-medium text-slate-300 dark:text-slate-300 theme-light:text-slate-700 hover:bg-slate-700/50 dark:hover:bg-slate-700/50 theme-light:hover:bg-slate-100 transition-colors duration-200 bg-blue-600/20 dark:bg-blue-600/20 theme-light:bg-blue-50 text-blue-200 dark:text-blue-200 theme-light:text-blue-700 border border-blue-500/30 dark:border-blue-500/30 theme-light:border-blue-200">Inicio</a>
        <a href="#" class="px-3 py-1.5 rounded-lg text-sm font-medium text-slate-300 dark:text-slate-300 theme-light:text-slate-600 hover:bg-slate-700/50 dark:hover:bg-slate-700/50 theme-light:hover:bg-slate-100 transition-colors duration-200 opacity-55 cursor-not-allowed" title="Pr√≥ximamente">Categor√≠as</a>
        <a href="#" class="px-3 py-1.5 rounded-lg text-sm font-medium text-slate-300 dark:text-slate-300 theme-light:text-slate-600 hover:bg-slate-700/50 dark:hover:bg-slate-700/50 theme-light:hover:bg-slate-100 transition-colors duration-200 opacity-55 cursor-not-allowed" title="Pr√≥ximamente">Promociones</a>
      </nav>
      <button id="toggleTheme" class="ml-auto px-4 py-2 rounded-full text-sm font-medium bg-slate-700/50 dark:bg-slate-700/50 theme-light:bg-slate-200 text-white dark:text-white theme-light:text-slate-700 hover:bg-slate-700 dark:hover:bg-slate-700 theme-light:hover:bg-slate-300 transition-colors duration-200 border border-slate-600/50 dark:border-slate-600/50 theme-light:border-slate-300">Oscuro</button>
      <a id="waHeader" href="#" target="_blank" rel="noopener" class="hidden px-4 py-2 rounded-full text-sm font-medium bg-green-600 text-white hover:bg-green-700 transition-colors duration-200 border border-green-500/30" style="display:none;">WhatsApp</a>
    </div>
  </header>
  <div class="max-w-7xl mx-auto px-4 py-4" id="catalogContainer">
    <section class="bg-gradient-to-br from-blue-900 via-teal-800 to-blue-900 text-white rounded-2xl p-8 mb-6 relative overflow-hidden shadow-xl" aria-label="Promociones destacadas">
      <h1 class="m-0 mb-3 text-2xl md:text-3xl font-bold">Encuentra tus repuestos</h1>
      <div id="heroSlider" class="hero-slider" data-autoplay="true" data-interval="6000" role="region" aria-roledescription="carousel" aria-label="Promociones" tabindex="0">
        <div class="hero-slides">
          <div class="hero-slide active" data-index="0" aria-label="Chequeo de frenos" aria-hidden="false">
            <h2>Chequeo de Frenos Gratis</h2>
            <p>Al comprar tus pastillas delanteras obtienes diagn√≥stico sin costo adicional.</p>
            <button class="slider-cta" data-action="detail" data-tag="frenos">Ver detalle</button>
          </div>
          <div class="hero-slide" data-index="1" aria-label="Cambio de aceite" aria-hidden="true">
            <h2>Servicio de Aceite Express</h2>
            <p>Agenda y listo en 45 minutos. Filtro + mano de obra incluida.</p>
            <button class="slider-cta" data-action="detail" data-tag="aceite">Ver detalle</button>
          </div>
          <div class="hero-slide" data-index="2" aria-label="Bater√≠as" aria-hidden="true">
            <h2>Bater√≠as con Instalaci√≥n</h2>
            <p>Instalaci√≥n en taller sin costo en referencias seleccionadas.</p>
            <button class="slider-cta" data-action="detail" data-tag="baterias">Ver detalle</button>
          </div>
        </div>
        <div class="hero-nav" role="tablist" aria-label="Selector de promoci√≥n">
          <button class="hero-dot active" data-go="0" role="tab" aria-selected="true" aria-controls="hero-slide-0"><span class="visually-hidden">1</span></button>
          <button class="hero-dot" data-go="1" role="tab" aria-selected="false" aria-controls="hero-slide-1"><span class="visually-hidden">2</span></button>
          <button class="hero-dot" data-go="2" role="tab" aria-selected="false" aria-controls="hero-slide-2"><span class="visually-hidden">3</span></button>
        </div>
        <div class="hero-arrows">
          <button class="hero-prev" aria-label="Anterior">‚óÄ</button>
          <button class="hero-next" aria-label="Siguiente">‚ñ∂</button>
        </div>
      </div>
    </section>

    <section class="mb-4" id="filters">
      <div class="flex gap-3 flex-wrap items-end">
        <label class="flex flex-col gap-1">
          <span class="text-xs text-slate-300 dark:text-slate-300 theme-light:text-slate-600 opacity-80">Buscar</span>
          <input id="f-q" placeholder="Nombre o SKU" class="px-3 py-2 rounded-lg border border-slate-600/50 dark:border-slate-600/50 theme-light:border-slate-300 bg-slate-700/50 dark:bg-slate-700/50 theme-light:bg-white text-white dark:text-white theme-light:text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500 min-w-[160px]" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs text-slate-300 dark:text-slate-300 theme-light:text-slate-600 opacity-80">Marca</span>
          <input id="f-brand" placeholder="Ej: RENAULT" class="px-3 py-2 rounded-lg border border-slate-600/50 dark:border-slate-600/50 theme-light:border-slate-300 bg-slate-700/50 dark:bg-slate-700/50 theme-light:bg-white text-white dark:text-white theme-light:text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500 min-w-[160px]" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs text-slate-300 dark:text-slate-300 theme-light:text-slate-600 opacity-80">Categor√≠a</span>
          <input id="f-category" placeholder="Ej: Frenos" class="px-3 py-2 rounded-lg border border-slate-600/50 dark:border-slate-600/50 theme-light:border-slate-300 bg-slate-700/50 dark:bg-slate-700/50 theme-light:bg-white text-white dark:text-white theme-light:text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500 min-w-[160px]" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs text-slate-300 dark:text-slate-300 theme-light:text-slate-600 opacity-80">Tags</span>
          <input id="f-tags" placeholder="Coma: pastillas,logan" class="px-3 py-2 rounded-lg border border-slate-600/50 dark:border-slate-600/50 theme-light:border-slate-300 bg-slate-700/50 dark:bg-slate-700/50 theme-light:bg-white text-white dark:text-white theme-light:text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500 min-w-[160px]" />
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs text-slate-300 dark:text-slate-300 theme-light:text-slate-600 opacity-80">Stock</span>
          <select id="f-stock" class="px-3 py-2 rounded-lg border border-slate-600/50 dark:border-slate-600/50 theme-light:border-slate-300 bg-slate-700/50 dark:bg-slate-700/50 theme-light:bg-white text-white dark:text-white theme-light:text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500 min-w-[160px]">
            <option value="1" selected>Solo con stock</option>
            <option value="all">Incluir agotados</option>
          </select>
        </label>
        <label class="flex flex-col gap-1">
          <span class="text-xs text-slate-300 dark:text-slate-300 theme-light:text-slate-600 opacity-80">Ordenar</span>
          <select id="f-order" class="px-3 py-2 rounded-lg border border-slate-600/50 dark:border-slate-600/50 theme-light:border-slate-300 bg-slate-700/50 dark:bg-slate-700/50 theme-light:bg-white text-white dark:text-white theme-light:text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500 min-w-[160px]">
            <option value="recent">M√°s recientes</option>
            <option value="price-asc">Precio: menor a mayor</option>
            <option value="price-desc">Precio: mayor a menor</option>
            <option value="name-asc">Nombre A-Z</option>
          </select>
        </label>
        <select id="f-limit" class="px-3 py-2 rounded-lg border border-slate-600/50 dark:border-slate-600/50 theme-light:border-slate-300 bg-slate-700/50 dark:bg-slate-700/50 theme-light:bg-white text-white dark:text-white theme-light:text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="12">12</option>
          <option value="20">20</option>
          <option value="40" selected>40</option>
        </select>
        <button id="f-apply" class="px-4 py-2 bg-slate-700/50 dark:bg-slate-700/50 hover:bg-slate-700 dark:hover:bg-slate-700 text-white dark:text-white font-semibold rounded-lg transition-all duration-200 border border-slate-600/50 dark:border-slate-600/50 theme-light:border-slate-300 theme-light:bg-slate-200 theme-light:text-slate-700 theme-light:hover:bg-slate-300 theme-light:hover:text-slate-900">Filtrar</button>
        <button id="f-clear" class="px-4 py-2 bg-slate-700/50 dark:bg-slate-700/50 hover:bg-slate-700 dark:hover:bg-slate-700 text-white dark:text-white font-semibold rounded-lg transition-all duration-200 border border-slate-600/50 dark:border-slate-600/50 theme-light:border-slate-300 theme-light:bg-slate-200 theme-light:text-slate-700 theme-light:hover:bg-slate-300 theme-light:hover:text-slate-900">Limpiar</button>
      </div>
    </section>

    <section id="catalogItemsSection">
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4" id="itemsGrid"></div>
      <div class="flex gap-2 justify-center flex-wrap mt-6 mb-6" id="pagination"></div>
    </section>
  </div>

  <!-- Floating action button for cart -->
  <div class="fixed right-4 bottom-4 z-40">
    <button id="openCart" title="Ver carrito" class="w-14 h-14 rounded-full bg-blue-600 hover:bg-blue-700 text-white border-0 shadow-lg font-bold cursor-pointer transition-colors duration-200 text-xl">üõí</button>
    <div id="cartBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs min-w-[20px] h-5 rounded-full flex items-center justify-center px-1.5 shadow-md" style="display:none;">0</div>
  </div>

  <!-- Cart modal -->
  <div id="cartModal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 bg-black/60 dark:bg-black/60 theme-light:bg-black/40 backdrop-blur-sm" aria-hidden="true">
    <div class="bg-slate-800 dark:bg-slate-800 theme-light:bg-white text-white dark:text-white theme-light:text-slate-900 w-full max-w-2xl max-h-[82vh] overflow-auto rounded-2xl p-4 shadow-2xl flex flex-col gap-3 custom-scrollbar border border-slate-700/50 dark:border-slate-700/50 theme-light:border-slate-300/50" role="dialog" aria-modal="true" aria-label="Carrito">
      <div class="flex items-center gap-2">
        <h3 class="m-0 text-lg font-semibold">Carrito (<span id="cartCount">0</span>)</h3>
        <button id="closeCart" class="ml-auto px-4 py-2 bg-slate-700/50 dark:bg-slate-700/50 hover:bg-slate-700 dark:hover:bg-slate-700 text-white dark:text-white font-semibold rounded-lg transition-all duration-200 border border-slate-600/50 dark:border-slate-600/50 theme-light:border-slate-300 theme-light:bg-slate-200 theme-light:text-slate-700 theme-light:hover:bg-slate-300 theme-light:hover:text-slate-900">Cerrar</button>
      </div>
      <div class="flex-1 overflow-auto flex flex-col gap-2 custom-scrollbar" id="cartItems"></div>
      <div class="text-sm flex flex-col gap-1 mt-2">
        <div>Total: <b id="cartTotal">0</b></div>
        <div class="flex gap-2 justify-end">
          <button id="cartCheckout" disabled class="px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-600 dark:to-blue-700 theme-light:from-blue-500 theme-light:to-blue-600 hover:from-blue-700 hover:to-blue-800 dark:hover:from-blue-700 dark:hover:to-blue-800 theme-light:hover:from-blue-600 theme-light:hover:to-blue-700 text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed">Checkout</button>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Mensaje si falta companyId
    document.addEventListener('DOMContentLoaded', () => {
      const url = new URL(window.location.href);
      if(!url.searchParams.get('companyId')){
        const cont = document.getElementById('catalogItemsSection');
        if(cont){
          cont.innerHTML = "<div class='p-10 text-center opacity-70 text-slate-300 dark:text-slate-300 theme-light:text-slate-600'>Falta companyId. Usa ?companyId=&lt;id&gt; en la URL para cargar el cat√°logo p√∫blico de una empresa.</div>";
        }
      }
      // FAB open/close handlers
      const openBtn = document.getElementById('openCart');
      const closeBtn = document.getElementById('closeCart');
      const modal = document.getElementById('cartModal');
      function openCart(){ modal.classList.remove('hidden'); modal.setAttribute('aria-hidden','false'); }
      function closeCart(){ modal.classList.add('hidden'); modal.setAttribute('aria-hidden','true'); }
      openBtn?.addEventListener('click', openCart);
      closeBtn?.addEventListener('click', closeCart);
      modal?.addEventListener('click', (e)=>{ if(e.target===modal) closeCart(); });
      
      // Theme toggle
      const themeToggle = document.getElementById('toggleTheme');
      if(themeToggle) {
        themeToggle.addEventListener('click', () => {
          document.body.classList.toggle('theme-light');
          const isLight = document.body.classList.contains('theme-light');
          themeToggle.textContent = isLight ? 'Claro' : 'Oscuro';
          localStorage.setItem('theme', isLight ? 'light' : 'dark');
        });
        
        // Load saved theme
        const savedTheme = localStorage.getItem('theme');
        if(savedTheme === 'light') {
          document.body.classList.add('theme-light');
          themeToggle.textContent = 'Claro';
        }
      }
    });
  </script>
</body>
</html>
