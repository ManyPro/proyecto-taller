<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Catálogo de Repuestos y Servicios | Taller</title>
  <meta name="description" content="Explora repuestos y servicios disponibles: stock actualizado, retiro en taller o envío en Bogotá." />
  <meta name="keywords" content="repuestos automotriz, taller, catálogo, envío bogotá, instalación" />
  <meta property="og:title" content="Catálogo de Repuestos y Servicios" />
  <meta property="og:description" content="Consulta disponibilidad y solicita tus repuestos con pago contra entrega." />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="es_CO" />
  <link rel="canonical" href="/catalogo.html" />
  <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
  <link rel="stylesheet" href="assets/styles.css" />
  <style>
    body.catalog-public { --pg-max-width: 1200px; }
    header.catalog-header { background: var(--card); padding: 12px 16px; box-shadow:0 2px 8px rgba(0,0,0,.15); position:sticky; top:0; z-index:50; }
    .catalog-container { max-width: var(--pg-max-width); margin: 0 auto; padding: 16px; }
    .hero { background: linear-gradient(135deg,#1e3a8a,#0f766e); color:#fff; padding:32px 20px; border-radius:14px; margin-bottom:24px; position:relative; overflow:hidden; }
    .hero h1 { margin:0 0 12px; font-size: clamp(1.4rem, 3.5vw, 2.2rem); }
  .hero-slider { position:relative; }
  .hero-slides { display:grid; }
  .hero-slide { opacity:0; transform:translateY(6px); transition:opacity .6s ease, transform .6s ease; position:relative; display:flex; flex-direction:column; gap:6px; padding:8px 4px; }
  .hero-slide.active { opacity:1; transform:translateY(0); }
  .hero-slide h2 { margin:0; font-size: clamp(1.05rem,2.6vw,1.6rem); }
  .hero-slide p { margin:0; font-size:14px; line-height:1.3; max-width:560px; }
  .hero-nav { display:flex; gap:8px; margin-top:14px; }
  .hero-dot { width:14px; height:14px; border-radius:50%; border:2px solid rgba(255,255,255,.7); background:transparent; cursor:pointer; padding:0; transition:background .3s,border-color .3s; }
  .hero-dot.active { background:#fff; border-color:#fff; }
  .hero-arrows { position:absolute; top:8px; right:8px; display:flex; gap:6px; }
  .hero-prev,.hero-next { background:rgba(255,255,255,.15); backdrop-filter:blur(4px); border:1px solid rgba(255,255,255,.25); color:#fff; padding:6px 10px; border-radius:8px; cursor:pointer; font-size:12px; }
  .hero-prev:hover,.hero-next:hover { background:rgba(255,255,255,.3); }
  .slider-cta { align-self:flex-start; margin-top:4px; background:#fff; color:#0f172a; font-weight:600; padding:8px 14px; border-radius:8px; border:0; cursor:pointer; font-size:13px; }
  .slider-cta:hover { background:#e2e8f0; }
  .visually-hidden { position:absolute !important; width:1px !important; height:1px !important; padding:0 !important; margin:-1px !important; overflow:hidden !important; clip:rect(0 0 0 0) !important; white-space:nowrap !important; border:0 !important; }
    .filters { display:flex; gap:12px; flex-wrap:wrap; margin-bottom:14px; }
    .filters input, .filters select { min-width:160px; }
    .grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(210px,1fr)); gap:14px; }
    .item-card { background: var(--card); border-radius:10px; padding:10px; display:flex; flex-direction:column; box-shadow:0 4px 12px rgba(0,0,0,.08); position:relative; }
    .item-card img { width:100%; aspect-ratio: 4/3; object-fit:cover; border-radius:8px; background:#fff; }
    .item-name { font-weight:600; margin:8px 0 4px; font-size:14px; line-height:1.2; }
    .item-price { font-size:15px; font-weight:700; color: var(--accent, #2563eb); }
    .item-tags { display:flex; flex-wrap:wrap; gap:4px; margin-top:6px; }
    .item-tags span { background: var(--chip-bg,#1e293b); color: var(--chip-text,#fff); padding:3px 6px; border-radius:6px; font-size:10px; letter-spacing:.3px; }
    .card-actions { margin-top:auto; display:flex; gap:6px; }
    .pagination { margin:22px 0; display:flex; gap:6px; justify-content:center; flex-wrap:wrap; }
    .pagination button { min-width:42px; }
    .empty { text-align:center; padding:40px 10px; opacity:.7; }
    .theme-toggle { position:fixed; right:10px; bottom:10px; z-index:100; }
    .cart-floating { position:fixed; left:10px; bottom:10px; background:var(--card); padding:10px 14px; border-radius:10px; box-shadow:0 4px 14px rgba(0,0,0,.35); width:280px; max-height:70vh; display:flex; flex-direction:column; gap:8px; }
    .cart-floating h3 { margin:0; font-size:14px; }
    .cart-items { flex:1; overflow:auto; display:flex; flex-direction:column; gap:6px; }
    .cart-item { display:flex; justify-content:space-between; gap:6px; font-size:12px; }
    .cart-item input { width:55px; }
    .cart-summary { font-size:12px; display:flex; flex-direction:column; gap:4px; }
    .search-hit { animation:blink .9s ease; }
    @keyframes blink { 0% { background:rgba(255,255,0,.35); } 100% { background:transparent; } }
    @media (max-width: 680px){ .cart-floating { width:calc(100% - 20px); left:50%; transform:translateX(-50%); bottom:12px; } }
  </style>
  <!-- Backend config must load before API to set API_BASE/BACKEND_URL -->
  <script src="./assets/js/config.js"></script>
  <script src="./assets/js/api.js"></script>
  <script type="module" src="./assets/js/api.esm.js"></script>
  <!-- Migrado a versión segmentada por empresa -->
  <script type="module" src="./assets/js/catalog-public.js"></script>
  <script type="module" src="./assets/js/promo-slider.js"></script>
  <script>
    // Lazy image upgrade (IntersectionObserver) para browsers sin soporte nativo avanzado
    document.addEventListener('DOMContentLoaded', () => {
      const supportsNative = 'loading' in HTMLImageElement.prototype;
      const imgs = document.querySelectorAll('img');
      if(supportsNative){
        imgs.forEach(im => im.setAttribute('loading','lazy'));
        return;
      }
      const obs = new IntersectionObserver(entries => {
        entries.forEach(e => {
          if(e.isIntersecting){
            const im = e.target;
            const src = im.dataset.src;
            if(src){ im.src = src; }
            obs.unobserve(im);
          }
        });
      }, { rootMargin: '200px' });
      imgs.forEach(im => {
        if(!im.dataset.src){ im.dataset.src = im.src; im.src = 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22150%22></svg>'; }
        obs.observe(im);
      });
    });
  </script>
</head>
<body class="catalog-public" data-page="catalog-public">
  <header class="catalog-header">
    <div style="display:flex;align-items:center;gap:14px;flex-wrap:wrap;">
      <strong style="font-size:16px;">Catálogo</strong>
      <nav style="display:flex;gap:10px;flex-wrap:wrap;font-size:12px;">
        <a href="catalogo.html" class="active">Inicio</a>
        <a href="#" style="opacity:.6;pointer-events:none;" title="Próximamente">Categorías</a>
        <a href="#" style="opacity:.6;pointer-events:none;" title="Próximamente">Promociones</a>
      </nav>
      <button id="toggleTheme" class="secondary" style="margin-left:auto;">Oscuro</button>
    </div>
  </header>
  <div class="catalog-container" id="catalogContainer">
    <section class="hero" aria-label="Promociones destacadas">
      <h1>Encuentra tus repuestos</h1>
      <div id="heroSlider" class="hero-slider" data-autoplay="true" data-interval="6000" role="region" aria-roledescription="carousel" aria-label="Promociones" tabindex="0">
        <div class="hero-slides">
          <div class="hero-slide active" data-index="0" aria-label="Chequeo de frenos" aria-hidden="false">
            <h2>Chequeo de Frenos Gratis</h2>
            <p>Al comprar tus pastillas delanteras obtienes diagnóstico sin costo adicional.</p>
            <button class="slider-cta" data-action="detail" data-tag="frenos">Ver detalle</button>
          </div>
          <div class="hero-slide" data-index="1" aria-label="Cambio de aceite" aria-hidden="true">
            <h2>Servicio de Aceite Express</h2>
            <p>Agenda y listo en 45 minutos. Filtro + mano de obra incluida.</p>
            <button class="slider-cta" data-action="detail" data-tag="aceite">Ver detalle</button>
          </div>
          <div class="hero-slide" data-index="2" aria-label="Baterías" aria-hidden="true">
            <h2>Baterías con Instalación</h2>
            <p>Instalación en taller sin costo en referencias seleccionadas.</p>
            <button class="slider-cta" data-action="detail" data-tag="baterias">Ver detalle</button>
          </div>
        </div>
        <div class="hero-nav" role="tablist" aria-label="Selector de promoción">
          <button class="hero-dot active" data-go="0" role="tab" aria-selected="true" aria-controls="hero-slide-0"><span class="visually-hidden">1</span></button>
          <button class="hero-dot" data-go="1" role="tab" aria-selected="false" aria-controls="hero-slide-1"><span class="visually-hidden">2</span></button>
          <button class="hero-dot" data-go="2" role="tab" aria-selected="false" aria-controls="hero-slide-2"><span class="visually-hidden">3</span></button>
        </div>
        <div class="hero-arrows">
          <button class="hero-prev" aria-label="Anterior">◀</button>
          <button class="hero-next" aria-label="Siguiente">▶</button>
        </div>
      </div>
    </section>

    <section class="filters" id="filters">
      <input id="f-q" placeholder="Buscar nombre o SKU" />
      <input id="f-category" placeholder="Categoría" />
      <input id="f-tags" placeholder="Tags coma" />
      <select id="f-stock">
        <option value="">Stock (todos)</option>
        <option value="1">Sólo con stock</option>
      </select>
      <select id="f-limit">
        <option value="12">12</option>
        <option value="20" selected>20</option>
        <option value="40">40</option>
      </select>
      <button id="f-apply" class="secondary">Filtrar</button>
      <button id="f-clear" class="secondary">Limpiar</button>
    </section>

    <section id="catalogItemsSection">
      <div class="grid" id="itemsGrid"></div>
      <div class="pagination" id="pagination"></div>
    </section>
  </div>

  <div class="cart-floating" id="cartBox">
    <h3>Carrito (<span id="cartCount">0</span>)</h3>
    <div class="cart-items" id="cartItems"></div>
    <div class="cart-summary">
      <div>Total: <b id="cartTotal">0</b></div>
      <button id="cartCheckout" disabled>Checkout</button>
    </div>
  </div>
  <script>
    // Mensaje si falta companyId
    document.addEventListener('DOMContentLoaded', () => {
      const url = new URL(window.location.href);
      if(!url.searchParams.get('companyId')){
        const cont = document.getElementById('catalogItemsSection');
        if(cont){
          cont.innerHTML = "<div style='padding:40px 10px;text-align:center;opacity:.7;'>Falta companyId. Usa ?companyId=&lt;id&gt; en la URL para cargar el catálogo público de una empresa.</div>";
        }
      }
    });
  </script>
</body>
</html>
