<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Restablecer contrase침a</title>
<link rel="stylesheet" href="assets/styles.css" />
<script src="./assets/js/config.js"></script>
<script src="./assets/js/api.js"></script>
<script type="module">
import { API } from './assets/js/api.esm.js';
const params = new URLSearchParams(location.search);
const token = params.get('token') || '';
const email = params.get('email') || '';
const form = document.getElementById('reset-form');
const pass1 = document.getElementById('new-pass');
const pass2 = document.getElementById('new-pass2');
const msg = document.getElementById('reset-msg');
const emailSpan = document.getElementById('reset-email');
emailSpan.textContent = email || '(desconocido)';
form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  if(pass1.value !== pass2.value){ msg.textContent='Las contrase침as no coinciden'; return; }
  msg.textContent='Procesando...';
  try{
    await fetch((API.base||'') + '/api/v1/auth/company/password/reset', {
      method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({ email, token, password:pass1.value })
    }).then(r=>r.json()).then(data=>{
      if(data.error) throw new Error(data.error);
      msg.textContent='Contrase침a actualizada. Puedes volver al inicio de sesi칩n.';
    });
  }catch(err){ msg.textContent = err.message || 'Error'; }
});
</script>
<style>
body{max-width:480px;margin:40px auto;padding:0 16px;} .card{margin-top:30px;}
</style>
</head>
<body>
  <nav class="tabs">
    <button data-tab="home" data-href="index.html">Inicio</button>
    <button data-tab="notas" data-href="notas.html">Notas</button>
    <button data-tab="ventas" data-href="ventas.html">Ventas</button>
    <button data-tab="cotizaciones" data-href="cotizaciones.html">Cotizaciones</button>
    <button data-tab="inventario" data-href="inventario.html">Inventario</button>
    <button data-tab="precios" data-href="precios.html">Lista de precios</button>
    <button data-tab="cashflow" data-href="cashflow.html">Flujo de Caja</button>
    <button data-tab="reporte-tecnico" data-href="reporte-tecnico.html">Reporte T칠cnico</button>
    <button data-tab="formatos" data-href="template-selector.html">Formatos</button>
    <button data-tab="skus" data-href="skus.html">SKUs</button>
    <button data-tab="reset" data-href="reset.html" class="active">Restablecer contrase침a</button>
    <button id="themeToggle" class="secondary" title="Cambiar tema">游깽</button>
  </nav>
  <h1>Restablecer contrase침a</h1>
  <div class="card">
    <p>Correo: <strong id="reset-email"></strong></p>
    <form id="reset-form">
      <label>Nueva contrase침a</label>
      <input id="new-pass" type="password" required minlength="6" />
      <label>Repetir contrase침a</label>
      <input id="new-pass2" type="password" required minlength="6" />
      <button>Cambiar contrase침a</button>
    </form>
    <p id="reset-msg" class="muted" style="margin-top:12px;"></p>
    <p style="margin-top:16px;"><a href="index.html">Ir a inicio de sesi칩n</a></p>
  </div>
</body>
</html>
