# Docker Compose para entorno de DESARROLLO/PRUEBAS
# Usa la misma base de datos pero con configuraciones de desarrollo
services:
  backend:
    build:
      context: ./Backend
      dockerfile: Dockerfile
    restart: unless-stopped
    env_file:
      - .env.dev
    environment:
      - NODE_ENV=development
      - PORT=3000
      - MONGODB_URI=${MONGODB_URI}
      - MONGODB_DB=${MONGODB_DB}
      - JWT_SECRET=${JWT_SECRET}
      - ALLOWED_ORIGINS=*
      - UPLOAD_DRIVER=${UPLOAD_DRIVER:-cloudinary}
      - CLOUDINARY_CLOUD_NAME=${CLOUDINARY_CLOUD_NAME}
      - CLOUDINARY_API_KEY=${CLOUDINARY_API_KEY}
      - CLOUDINARY_API_SECRET=${CLOUDINARY_API_SECRET}
      - CLD_FOLDER=${CLD_FOLDER:-taller-dev}
      - LOG_LEVEL=debug
      - PUBLIC_RATE_MAX=1000
      - CHECKOUT_RATE_MAX=1000
      - AUTH_RATE_MAX=1000
      - CACHE_VERSION=dev-v1
    ports:
      - "4001:3000"  # Puerto diferente para desarrollo
    volumes:
      - uploads_data_dev:/app/uploads
      - ./Backend:/app  # Hot reload para desarrollo

  frontend:
    build:
      context: ./Frontend
      dockerfile: Dockerfile
    restart: unless-stopped
    depends_on:
      - backend
    ports:
      - "8080:80"  # Puerto diferente para desarrollo
    environment:
      - NGINX_PORT=80

volumes:
  uploads_data_dev:
